name: Maven CI

on:
  push:
    branches: [ main, develop, feature/**, fix/** ]
  pull_request:
    branches: [ main, develop ]

jobs:
  buildExpected:
    name: buildExpected
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Java 21 (Temurin)
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
          cache: maven

      - name: Maven compile
        run: mvn -B clean compile

  mvn_test_expected:
    name: mvn testExpected
    runs-on: ubuntu-latest
    needs: buildExpected
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Java 21 (Temurin)
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
          cache: maven

      - name: Maven test
        run: mvn -B test

      - name: Upload JaCoCo report (optional)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: jacoco-report
          path: target/site/jacoco/

  testExpected:
    name: testExpected
    runs-on: ubuntu-latest
    needs: mvn_test_expected
    steps:
      - name: Acknowledge tests complete
        run: echo "Tests completed in 'mvn testExpected'."
